\section{Bottom $k$-sampling}

\subsection{Frequency estimation}

\paragraph{Exercise 2}
We want to prove the following:

\[
    E[|C \cap S^k_h(A)|/k] = |C|/|A|
\]

For each $x \in C$, the probablility $Pr[x \in S^k_h(A)]$ that $x$ is in the bottom-$k$ sample of $A$ is $\frac{k}{|A|}$. Thus, we expect $\frac{|C|k}{|A|}$ elements from $C$ to appear in $S^k_h(A)$, or in other words, $E[|C \cap S^k_h(A)|] = \frac{|C|k}{|A|}$. Divide by $k$, and we get $\frac{|C|}{|A|}$. 

\subsection{Similarity estimation}

\paragraph{Exercise 4}
Given two bottom-$k$ samples, $S^k_h(A)$ and $S^k_h(B)$, we can prove that:

\paragraph*{(a)}
$S^k_h(A \cup B) = S^k_h(S^k_h(A) \cup S^k_h(B))$

We'll start by showing that $S^k_h(A \cup B) \subseteq S^k_h(S^k_h(A) \cup S^k_h(B))$. We'll do this using a proof by contradiction.

Given some $x \in S^k_h(A \cup B)$, assume $x \notin S^k_h(S^k_h(A) \cup S^k_h(B))$.

By that assumption, there are at least $k$ elements from $S^k_h(A) \cup S^k_h(B)$ that has to smaller values than $x$. All of these elements also appear in $A \cup B$, which means that they are better candidates for $S^k_h(A \cup B)$ than $x$ is. This is a contradiction.

Now, we know that both of the sets have size $k$, because they are bottom-$k$ samples. If two sets have the same size, and one is a subset of the other, then they must be equivalent -- there cannot be an element in $S^k_h(S^k_h(A) \cup S^k_h(B))$ that does not appear in $S^k_h(A \cup B)$, because if there were, $S^k_h(S^k_h(A) \cup S^k_h(B))$ would be larger.

\paragraph*{(b)}
$A \cap B \cap S^k_h(A \cup B) = S^k_h(A) \cap S^k_h(B) \cap S^k_h(A \cup B)$

We'll start by showing that $S^k_h(A) \cap S^k_h(B) \cap S^k_h(A \cup B) \subseteq A \cap B \cap S^k_h(A \cup B)$.

An element $x \in S^k_h(A) \cap S^k_h(B) \cap S^k_h(A \cup B)$ is in $S^k_h(A)$, which means that it is also in $A$, and it is in $S^k_h(B)$, which means that it is also in $B$, and it is in $S^k_h(A \cup B)$, which is a requirement for both sides of the equation. Therefore, it is in $A \cap B \cap S^k_h(A \cup B)$.

We then show that $A \cap B \cap S^k_h(A \cup B) \subseteq S^k_h(A) \cap S^k_h(B) \cap S^k_h(A \cup B)$.

For some $x \in A \cap B \cap S^k_h(A \cup B)$, $x$ is also in $S^k_h(A \cup B)$. If we look at (a), this is equivalent with saying that $x \in S^k_h(S^k_h(A) \cup S^k_h(B))$, which also tells us that $x$ is either in $S^k_h(A)$ or in $S^k_h(B)$. Now, because $x$ is in both $A$ and $B$, it must also be in both $S^k_h(A)$ and $S^k_h(B)$ -- if it was in $S^k_h(A)$, but not in $S^k_h(B)$, then $S^k_h(B)$ would consist of $k$ elements that hash to smaller values that $x$ does, and then $x$ would \emph{not} be in $S^k_h(S^k_h(A) \cup S^k_h(B))$, which would be a contradiction. The same happens if $x$ is in $S^k_h(B)$, but not in $S^k_h(A)$. This concludes the proof.

\paragraph*{(c)}
We can do both union and intersection of sorted sets in linear time. Finding the size of a set is either constant or linear time, depending on implementation, so all in all, we get linear time.

The algorithm for union of two sorted sets is as follows:

\begin{verbatim}
Union(A, B)
  Let C be an empty set.
  Repeat until A and B are both empty:
    Let x be the first element of A, and y be the first element of B.
    If x = y:
      Add x to the end of C
      Remove x from A and y from B
    Else if x < y:
      Add x to C
      Remove x from A
    Else:
      Add y to C
      Remove y from B
  Return C
\end{verbatim}

The algorithm for intersection of two sorted sets is as follows:

\begin{verbatim}
Intersection(A, B)
  Let C be an empty set.
  Repeat until A and B are both empty:
    Let x be the first element of A, and y be the first element of B.
    If x = y:
      Add x to the end of C
      Remove x from A and y from B
    Else if x < y:
      Remove x from A
    Else:
      Remove y from B
  Return C
\end{verbatim}
